<%
	require "luci.sys"
local load1, load5, load15 = luci.sys.loadavg()
	local http = require "luci.http"
	local disp = require "luci.dispatcher"

	local request  = disp.context.path
	local request2 = disp.context.request
local category = request[1]
	local leaf = request2[#request2]
local tree     = luci.dispatcher.node()
local cattree  = category and luci.dispatcher.node(category)
local node     = luci.dispatcher.context.dispatched
	
local c = tree
for i,r in ipairs(request) do
	if c.nodes and c.nodes[r] then
		c = c.nodes[r]
		c._menu_selected = true
	end
end


	local function nodeurl(prefix, name, query)
		local url = controller .. prefix .. name .. "/"
		if query then
			url = url .. luci.http.build_querystring(query)
		end
		return pcdata(url)
	end

	local function subtree(prefix, node, level)
		%><%=node.nodes[0]%><%
		if not node.nodes or node.hidden then
			return false
		end

		if not level then
			level = 1
		end
		local index = {}
		local count = 0
		for k, n in pairs(node.nodes) do
			if n.title and n.target then
				table.insert(index, {name=k, order=n.order or 100})
				count = count + 1
			end
		end

		table.sort(index, function(a, b) return a.order < b.order end)

		if count > 0 then
			local selected_node
			local selected_name
			for j, v in pairs(index) do
				if #v.name > 0 then
					local nnode = node.nodes[v.name]

					if nnode._menu_selected then
						selected_node = nnode
						selected_name = v.name
					end
					%><li class="tabmenu-lv<%=level%>" >
						<a style="display:block;padding-left:<%=(level-1)*20+5%>px;<% if nnode._menu_selected or (node.leaf and v.name == leaf) then %>font-weight:bold;background:#b8cee0;color:#000000<% end %>"  href="<%=nodeurl(prefix, v.name, nnode.query)%>"><%=striptags(translate(nnode.title))%></a>
					</li>		<%
					if nnode._menu_selected then
						subtree(prefix .. selected_name .. "/", selected_node, level + 1)
					elseif (v.name=="network" and level<2) then
						subtree(prefix .. v.name .. "/", nnode, level + 1)
					end
			
				end
			end
		end
	end




         http.prepare_content("text/html; charset=UTF-8")
	
	local ver  = require "luci.version"
	math.randomseed(os.time())
	local random = math.random()
-%>

<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<%=luci.i18n.context.lang%>" lang="<%=luci.i18n.context.lang%>">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=0.9,maximum-scale=2" />
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
<meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<script type="text/javascript" src="<%=resource%>/xhr.js"></script>
<title>WifiSong</title>
<script type="text/javascript" src="<%=resource%>/web/js/jquery-1.8.1.min.js?v=<%=ver.svnRevNum%>"></script>
<link rel="stylesheet" href="<%=resource%>/mobile/css/jquery.mobile-1.1.0.css?v=<%=ver.svnRevNum%>" />
<link rel="stylesheet" href="<%=resource%>/mobile/css/mobile.css?v=<%=ver.svnRevNum%>" />
<script src="<%=resource%>/mobile/js/jquery.mobile-1.1.0.js?v=<%=ver.svnRevNum%>"></script>
</head>
<body>
<div data-role="page" id="page1" data-dom-cache="false">
	<div data-theme="b" data-role="header">
		
		<h1 class="jqm-logo" style="margin:9px 5px 12px 5px;"></h1>
		<%
		if leaf == "info" or leaf == "network" or leaf == "wifi" or leaf == "reboot" or leaf == "guide" or leaf == "network" or leaf == "wan" or leaf == "lan" or leaf == "overview" or leaf == "wireless" or leaf == "radio0.network1" or leaf == "radio0.network2" or leaf == "radio0.network3" or leaf == "radio0.network4" or leaf == "radio0.network5" then
		%>
			<a data-role="button" style="top: 6px;" data-transition="flip" data-theme="b" href="<%=luci.dispatcher.build_url('mobile')%>?<%=random%>" data-icon="home" data-iconpos="left" <%if is_home==1 then%>style="display:none;"<%end%> >
	       		<%:首页%>
	        </a>
		<%
		end
		%>
		<%
		if leaf == "mobile" then
		%>
			<a data-role="button" style="top: 6px;" data-transition="flip" data-theme="b" href="<%=luci.dispatcher.build_url('admin')%>" target="_blank" data-icon="forward" data-iconpos="left">
	       		<%:电脑版%>
	        </a>
		<%
		end
		%>
	</div>
	<div data-role="content" style="padding-top:5px;">
		<div data-role="navbar" data-iconpos="left">
		</div> 
